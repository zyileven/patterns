# å•ä¾‹æ¨¡å¼

åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å…±äº«ä¸€ä¸ªå…¨å±€å®ä¾‹

å•ä¾‹æ˜¯å¯ä»¥å®ä¾‹åŒ–ä¸€æ¬¡å¹¶å¯ä»¥å…¨å±€è®¿é—®çš„ç±»ã€‚è¿™ä¸ªå•ä¸€å®ä¾‹å¯ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å…±äº«ï¼Œè¿™ä½¿å¾—å•ä¾‹éå¸¸é€‚åˆç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å…¨å±€çŠ¶æ€ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨ ES2015 ç±»çš„å•ä¾‹æ˜¯ä»€ä¹ˆæ ·å­ã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª`Counter`å…·æœ‰ä»¥ä¸‹å†…å®¹çš„ç±»ï¼š

```javascript
let counter = 0;

class Counter {
  getInstance() {
    return this;
  }
  
  getCount() {
    return counter;
  }
  
  increament() {
    return ++counter;
  }
  
  descrement() {
    return --counter;
  }
}
```

- `getInstance`è¿”å›è¿™ä¸ªç±»çš„å®ä¾‹
- `getCount`è¿”å›å½“å‰çš„`counter`å€¼
- `increment`å°†`counter`åŠ ä¸€
- `descrement`å°†`counter`å‡ä¸€

ä½†æ˜¯è¿™ä¸ªç±»å¹¶ä¸ç¬¦åˆå•ä¾‹æ¨¡å¼çš„æ ‡å‡†ï¼Œå³â€œ**åªèƒ½è¢«å®ä¾‹åŒ–ä¸€æ¬¡**â€ï¼Œå› ä¸ºä¸Šé¢çš„`Counter`ç±»å¯ä»¥è¢«å®ä¾‹åŒ–å¤šæ¬¡ã€‚



```javascript
const counter1 = new Counter();
const counter2 = new Counter();
// å¹¶ä¸”ä¸¤ä¸ªå®ä¾‹å¹¶ä¸ç›¸ç­‰
console.log(counter1.getInstance() === counter2.getInstance()); // false
```

<img src="https://raw.githubusercontent.com/zyileven/image-hosting-platform/master/src/2023/08/22/2b5283b0b56415594156e5b955526ab1-image-20230822225141511-e2de73.png" alt="image-20230822225141511" style="zoom:50%;" />

é‚£ä¹ˆæƒ³è¦ç¡®ä¿åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„åŠæ³•å°±æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºinstanceçš„å®ä¾‹ï¼Œç„¶ååœ¨Counterçš„æ„é€ å‡½æ•°constructorä¸­åˆ¤æ–­æ˜¯å¦å·²ç»åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºå°±æŠ›å‡ºé”™è¯¯ï¼Œå¦åˆ™å°†å½“å‰å®ä¾‹ä¼ é€’ç»™è¿™ä¸ªå˜é‡ã€‚

```javascript
// counter.js
let instance;
let counter = 0;

class Counter {
  constructor() {
    if (instance) {
      throw new Error("You can only create one instance")
    }
    instance = this;
  }
  
  getInstance() {
    return this;
  }
  
  getCount() {
    return counter;
  }
  
  increament() {
    return ++counter;
  }
  
  descrement() {
    return --counter;
  }
}

const counter1 = new Counter();
const counter2 = new Counter();
// Error: You can only create one instance
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»counterä¸­åˆ°å¤„ä¸€ä¸ªå®ä¾‹ï¼Œä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸ºå®ƒåŠ ä¸Šä¸€é‡ä¿é™©ï¼ˆObject.freezeï¼‰ï¼Œæ­¤æ–¹æ³•å¯ä»¥ç¡®ä¿ä½¿ç”¨ä»£ç æ— æ³•ä¿®æ”¹å•ä¾‹ï¼Œæ— æ³•æ·»åŠ æˆ–è€…ä¿®æ”¹å†»ç»“å®ä¾‹ä¸Šçš„å±æ€§ï¼Œé™ä½äº†æ„å¤–è¦†ç›–å•ä¾‹ä¸Šçš„å€¼çš„é£é™©ã€‚

```javascript
const singletonCounter = Object.freeze(new Counter());
export default singletonCounter;
```

ç°åœ¨æˆ‘ä»¬ä½¿ç”¨counter.jsä¸­çš„å•ä¾‹æ¥å®ç°ä¸€äº›åŠŸèƒ½

```javascript
// çº¢è‰²æŒ‰é’®ï¼Œç‚¹å‡»+1
import singletonCounter from "./counter";

const button = document.getElementById("red")
button.addEventLister("click", () => {
  singletonCounter.increment();
  console.log("total:", singletonCounter.getCount())
})
```

```javascript
// è“è‰²æŒ‰é’®ï¼Œç‚¹å‡»11
import singletonCounter from "./counter";

const button = document.getElementById("blue")
button.addEventLister("click", () => {
  singletonCounter.decrement();
  console.log("total:", singletonCounter.getCount())
})
```

```javascript
import "./redButton";
import "./blueButton";

console.log("Click on either of the buttons ğŸš€!");
```

![image-20230822230959786](https://raw.githubusercontent.com/zyileven/image-hosting-platform/master/src/2023/08/22/702e290ec527e219be2431875aa07496-image-20230822230959786-c1be94.png)

åœ¨redButtonå’ŒblueButtonä¸­å¼•å…¥çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯åŸºäºåŒä¸€ä¸ªå®ä¾‹è¿›è¡Œçš„ä¸€äº›ä¿®æ”¹ã€‚



## æƒè¡¡

å°†å®ä¾‹é™åˆ¶ä¸ºä¸€ä¸ªå•ä¾‹å¯èƒ½ä¼šèŠ‚çœå¤§é‡å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ä¸å¿…æ¯æ¬¡éƒ½ä¸ºä¸€ä¸ªæ–°å®ä¾‹è®¾ç½®å†…å­˜ï¼Œå¹¶ä¸”è¯¥å®ä¾‹åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­éƒ½ä¼šè¢«å¼•ç”¨ã€‚ç„¶è€Œï¼Œå•ä¾‹æ¨¡å¼å®é™…ä¸Šè¢«è®¤ä¸ºæ˜¯ä¸€ç§åæ¨¡å¼ï¼Œåº”è¯¥åœ¨javascriptä»£ç ä¸­é¿å…ä½¿ç”¨ã€‚

## ç¼ºç‚¹

æµ‹è¯•ä¾èµ–äºå•ä¾‹çš„ä»£ç å¯èƒ½ä¼šå¾ˆæ£˜æ‰‹ï¼Œç”±äºä¸èƒ½æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æµ‹è¯•éƒ½ä¾èµ–äºå¯¹ä¸Šä¸€æ¬¡æµ‹è¯•çš„å…¨éƒ¨å®ä¾‹çš„ä¿®æ”¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµ‹è¯•çš„é¡ºåºå¾ˆé‡è¦ï¼Œä¸€ä¸ªå°çš„ä¿®æ”¹å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæµ‹è¯•å¥—ä»¶å¤±è´¥ã€‚æµ‹è¯•å®Œæˆåï¼Œéœ€è¦é‡ç½®æ•´ä¸ªå®ä¾‹ï¼Œä»¥é‡ç½®æµ‹è¯•æ‰€åšçš„ä¿®æ”¹ã€‚

```javascript
import Counter from "../src/counterTest";

test("incrementing 1 time should be 1", () => {
  Counter.increment();
  expect(Counter.getCount()).toBe(1);
});

test("incrementing 3 extra times should be 4", () => {
  Counter.increment();
  Counter.increment();
  Counter.increment();
  expect(Counter.getCount()).toBe(4);
});

test("decrementing 1  times should be 3", () => {
  Counter.decrement();
  expect(Counter.getCount()).toBe(3);
});
```

Singletonå®ä¾‹åº”è¯¥èƒ½å¤Ÿè¢«å…¨å±€ä½¿ç”¨ï¼Œä½†æ˜¯å…¨å±€å˜é‡è¿™ç§è®¾è®¡æœ¬èº«å°±æ˜¯ä¸€ä¸ªç³Ÿç³•çš„è®¾è®¡ï¼Œå…¨å±€åˆå®‰æœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„é”™è¯¯ã€‚





